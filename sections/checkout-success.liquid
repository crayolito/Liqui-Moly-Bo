{{ 'section-checkout-success.css' | asset_url | stylesheet_tag }}

<div class="checkout-success-container">
  <div class="checkout-success-content">
    <div class="success-icon">
      <img
        src="{{ 'imagen-check-verde.png' | asset_url }}"
        alt="Pedido Confirmado"
        class="success-image"
        width="100"
        height="100"
      >
    </div>

    <h1 class="success-title">¡PEDIDO CONFIRMADO!</h1>

    <p class="success-message">
      En breve te conectaremos con nuestro equipo<br>
      vía WhatsApp para coordinar tu entrega
    </p>

    <div class="order-number">
      <span
        >Orden #<span id="order-number">{{ 'now' | date: '%Y%m%d%H%M%S' }}</span></span
      >
    </div>

    <div class="order-details" id="order-details">
      <!-- Los detalles del pedido se cargarán aquí -->
    </div>

    <div class="success-actions">
      <a href="{{ routes.root_url }}" class="button button-primary"> Continuar Comprando </a>
      <button id="whatsapp-contact" class="button button-secondary">Contactar por WhatsApp</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Obtener datos del pedido desde localStorage
    const orderData = JSON.parse(localStorage.getItem('customOrderData') || '{}');

    if (orderData.orderNumber) {
      document.getElementById('order-number').textContent = orderData.orderNumber;
    }

    if (orderData.items) {
      displayOrderDetails(orderData.items, orderData.total);
    }

    // Configurar botón de WhatsApp
    document.getElementById('whatsapp-contact').addEventListener('click', function () {
      const message = `Hola! Mi pedido #${
        orderData.orderNumber || 'NUEVO'
      } ha sido confirmado. Me gustaría coordinar la entrega.`;
      const whatsappUrl = `https://wa.me/{{ section.settings.whatsapp_number }}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    });

    // Limpiar datos después de mostrar
    localStorage.removeItem('customOrderData');
  });

  function displayOrderDetails(items, total) {
    const detailsContainer = document.getElementById('order-details');
    let html = '<div class="order-summary"><h3>Resumen del Pedido:</h3><ul>';

    items.forEach((item) => {
      html += `<li>${item.quantity}x ${item.title} - ${item.price}</li>`;
    });

    html += `</ul><div class="order-total"><strong>Total: ${total}</strong></div></div>`;
    detailsContainer.innerHTML = html;
  }
</script>

{% schema %}
{
  "name": "Checkout Success",
  "settings": [
    {
      "type": "text",
      "id": "whatsapp_number",
      "label": "Número de WhatsApp",
      "default": "1234567890",
      "info": "Número de WhatsApp para contacto (incluir código de país sin +)"
    }
  ]
}
{% endschema %}
