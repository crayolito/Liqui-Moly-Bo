{% comment %}
  =====================================================
  SECCIÓN: Menús Desplegables con Diseño Expandable
  MÓVIL: Estilo expandable con iconos y animación
  DESKTOP: Grid centrado de 3-4 columnas
  =====================================================
{% endcomment %}

{{ 'component-facets.css' | asset_url | stylesheet_tag }}

{% liquid
  assign titulo_seccion = section.settings.heading
  assign mostrar_titulo = section.settings.mostrar_titulo
  assign color_scheme_string = section.settings.color_scheme | append: ''
  assign block_section_class = 'block-section'
  unless color_scheme_string == 'background-1'
    assign block_section_class = block_section_class | append: ' block-section-padded'
  endunless
%}

<style>
  #shopify-section-{{ section.id }} .block-section {
    margin-top: {{ section.settings.spacing_top | times: 0.8 | round: 0 }}px;
    margin-bottom: {{ section.settings.spacing_bottom | times: 0.8 | round: 0 }}px;
  }

  #shopify-section-{{ section.id }} .block-section-padded {
    margin-top: 0;
    margin-bottom: 0;
    padding-top: {{ section.settings.spacing_top | times: 0.8 | round: 0 }}px;
    padding-bottom: {{ section.settings.spacing_bottom | times: 0.8 | round: 0 }}px;
  }

  @media (min-width: 990px) {
    #shopify-section-{{ section.id }} .block-section {
      margin-top: {{ section.settings.spacing_top }}px;
      margin-bottom: {{ section.settings.spacing_bottom }}px;
    }

    #shopify-section-{{ section.id }} .block-section-padded {
      margin-top: 0;
      margin-bottom: 0;
      padding-top: {{ section.settings.spacing_top }}px;
      padding-bottom: {{ section.settings.spacing_bottom }}px;
    }
  }
</style>

<div class="color-{{ section.settings.color_scheme }}">
  <div class="container {% if section.settings.narrow %} container-narrow{% endif %}">
    <div class="{{ block_section_class }}">
      <!-- Título de la sección -->
      {% if mostrar_titulo and titulo_seccion != blank %}
        <div class="block-block-section-title-wrapper">
          <div class="block-section-title-wrap text-{{ section.settings.heading_alignment }}">
            <{{ section.settings.heading_tag }} class="block-section-title heading-size-{{ section.settings.heading_size }}">
              {{- titulo_seccion -}}
            </{{ section.settings.heading_tag }}>
          </div>
        </div>
      {% endif %}

      <!-- Contenedor de menús -->
      <div class="menus-desplegables-container">
        {% for bloque in section.blocks limit: 4 %}
          {%- liquid
            assign menu_handle = bloque.settings.menu_seleccionado
            assign titulo_menu = bloque.settings.titulo_personalizado
            assign icono_menu = bloque.settings.icon
            assign mostrar_icono = bloque.settings.mostrar_icono
            assign menu_obj = linklists[menu_handle]

            if titulo_menu == blank and menu_obj
              assign titulo_menu = menu_obj.title
            endif
          -%}

          <!-- Cada menú con estilo expandable -->
          <collapsible-expandable expanded="false" class="menu-expandable-item">
            <div class="facet">
              <button
                class="facet-toggle"
                type="button"
                aria-expanded="false"
                data-menu-index="{{ forloop.index }}"
              >
                <span>
                  {% if mostrar_icono and icono_menu != blank %}
                    {% render 'icons', icon: icono_menu %}
                  {% endif %}
                  {{ titulo_menu | default: 'Menú' }}
                </span>
                {% render 'angle', direction: 'down' %}
              </button>

              <div class="facet-content menu-links-content">
                {% if menu_obj and menu_obj.links.size > 0 %}
                  <ul class="menu-links-list">
                    {% for link in menu_obj.links %}
                      <li>
                        <a href="{{ link.url }}" class="menu-link-item">
                          {{ link.title }}
                        </a>
                      </li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p class="menu-vacio">Selecciona un menú en la configuración</p>
                {% endif %}
              </div>
            </div>
          </collapsible-expandable>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<style>
  /* ===== ESTILOS DESKTOP: Grid centrado ===== */
  .menus-desplegables-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  /* Cada item de menú */
  .menu-expandable-item {
    display: block;
  }

  /* Ocultar bordes en desktop */
  @media (min-width: 990px) {
    .menu-expandable-item .facet {
      border-top: none !important;
      border-bottom: none !important;
    }
  }

  /* Títulos en desktop siempre visibles */
  @media (min-width: 990px) {
    .menu-expandable-item .facet-toggle {
      cursor: default;
      pointer-events: none;
    }

    .menu-expandable-item .facet-toggle .angle {
      display: none;
    }

    .menu-expandable-item .facet-content {
      max-height: none !important;
      overflow: visible !important;
    }
  }

  /* Links del menú */
  .menu-links-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .menu-links-list li {
    margin-bottom: 0.8rem;
  }

  .menu-link-item {
    display: block;
    color: rgba(var(--color-accent-1));
    text-decoration: none;
    transition: all 0.3s ease;
  }

  [class*='color-'] .menu-link-item:hover {
    text-decoration: underline;
    text-decoration-thickness: 0.2rem;
  }

  .menu-vacio {
    color: rgba(var(--color-foreground), 0.55);
    font-style: italic;
    margin: 0;
    font-size: 0.9rem;
  }

  /* ===== MÓVIL: Columna completa ===== */
  @media (max-width: 989px) {
    .menus-desplegables-container {
      grid-template-columns: 1fr;
      gap: 0;
    }
  }
</style>

{%- if request.design_mode -%}
  <script src="{{ 'theme-editor.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{% schema %}
{
  "name": "Menús Desplegables",
  "tag": "section",
  "class": "section-menus-desplegables",
  "settings": [
    {
      "type": "header",
      "content": "Contenido de la sección"
    },
    {
      "type": "checkbox",
      "id": "mostrar_titulo",
      "label": "Mostrar título de la sección",
      "default": true
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "Título de la sección",
      "default": "Nuestros Menús"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Tamaño del título",
      "default": "md",
      "options": [
        { "value": "sm", "label": "Pequeño" },
        { "value": "md", "label": "Mediano" },
        { "value": "lg", "label": "Grande" },
        { "value": "xl", "label": "Extra grande" },
        { "value": "xxl", "label": "XXL" }
      ]
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Alineación del título",
      "default": "center",
      "options": [
        { "value": "left", "label": "Izquierda" },
        { "value": "center", "label": "Centro" }
      ]
    },
    {
      "type": "header",
      "content": "Diseño"
    },
    {
      "type": "checkbox",
      "id": "narrow",
      "label": "Contenedor angosto",
      "default": false,
      "info": "Hace el contenedor más estrecho y centrado"
    },
    {
      "type": "header",
      "content": "Colores"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Esquema de color",
      "default": "background-1"
    },
    {
      "type": "header",
      "content": "Espaciado"
    },
    {
      "type": "range",
      "id": "spacing_top",
      "min": 0,
      "max": 150,
      "step": 2,
      "default": 60,
      "label": "Espaciado superior"
    },
    {
      "type": "range",
      "id": "spacing_bottom",
      "min": 0,
      "max": 150,
      "step": 2,
      "default": 60,
      "label": "Espaciado inferior"
    },
    {
      "type": "header",
      "content": "SEO"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "Etiqueta del título",
      "default": "h2",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" }
      ]
    }
  ],
  "blocks": [
    {
      "type": "menu",
      "name": "Menú",
      "settings": [
        {
          "type": "link_list",
          "id": "menu_seleccionado",
          "label": "Seleccionar menú",
          "info": "Elige el menú de navegación"
        },
        {
          "type": "text",
          "id": "titulo_personalizado",
          "label": "Título personalizado (opcional)",
          "info": "Si está vacío, usará el nombre del menú"
        },
        {
          "type": "checkbox",
          "id": "mostrar_icono",
          "label": "Mostrar icono",
          "default": true
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icono",
          "options": [
            { "label": "Sin icono", "value": "" },
            { "label": "Tienda", "value": "store" },
            { "label": "Bolsa", "value": "bag" },
            { "label": "Etiquetas", "value": "tags" },
            { "label": "Caja", "value": "box" },
            { "label": "Menú", "value": "menu" },
            { "label": "Info", "value": "info" },
            { "label": "Teléfono", "value": "phone" },
            { "label": "Email", "value": "email" },
            { "label": "Ubicación", "value": "pin" },
            { "label": "Camión", "value": "truck" },
            { "label": "Estrella", "value": "star-full" },
            { "label": "Corazón", "value": "heart" },
            { "label": "Check", "value": "check" }
          ]
        }
      ]
    }
  ],
  "max_blocks": 4,
  "presets": [
    {
      "name": "Menús Desplegables",
      "blocks": [
        { "type": "menu", "settings": { "icon": "store" } },
        { "type": "menu", "settings": { "icon": "box" } },
        { "type": "menu", "settings": { "icon": "truck" } },
        { "type": "menu", "settings": { "icon": "phone" } }
      ]
    }
  ]
}
{% endschema %}
